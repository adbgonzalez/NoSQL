# Unidade 2 – Bases de Datos NoSQL
![ecosistema](images/nosql.png)

# 1. Introdución ás BBDD NoSQL

Estamos na terceira plataforma de almacenamento de datos:

## 1.1 Evolución das plataformas
1. **1ª plataforma:** ordenadores → modelo relacional  
2. **2ª xeración:** internet → modelo cliente-servidor  
3. **3ª xeración:** cloud, RRSS, dispositivos móbiles → NoSQL e Big Data  

**NoSQL (Not Only SQL)** complementa ás BBDD relacionais para resolver:
- Grandes volumes de datos
- Alta velocidade de acceso
- Datos semi/non estruturados
- Necesidade de escalabilidade horizontal
- Flexibilidade do esquema

---

## 1.2 Propiedades ACID vs necesidade de flexibilidade
**ACID**:
- **Atomicidade:** ou todo ou nada  
- **Consistencia:** estados válidos  
- **Illamento:** transaccións independentes  
- **Durabilidade:** os datos non se perden  

Nos escenarios modernos, este modelo é demasiado restritivo.

---

## 1.3 Tipos de BBDD NoSQL
- **Clave-valor:** Redis, Riak, DynamoDB, *Elasticsearch (internamente)*  
- **Documentais:** MongoDB, CouchDB, Elasticsearch  
- **Columnar / Wide-Column:** Cassandra, HBase, BigTable  
- **Grafos:** Neo4j, ArangoDB, Neptune  

---

# 2. Características comúns das BBDD NoSQL
- Admite datos estruturados, semi-estruturados e non estruturados  
- Esquemas dinámicos  
- Escalabilidade horizontal nativa  
- Alta dispoñibilidade  
- Replicación e particionado nativos  

---

# 3. Esquemas dinámicos
As BBDDR requiren esquema fixo.

Esto choca cos enfoques de desenvolvemento áxil, xa que ao engadir novas funcionalidades o esquema pode cambiar -> Se se engade un campo a unha táboa hai que migrar a BD a un novo esquema.

As BBDD NoSQL permiten inserir documentos con diferentes campos, evitando migracións custosas.

---

# 4. Particionado (Sharding)

## 4.1 Por que particionar?
- Escalar horizontalmente  
- Mellorar rendemento  
- Evitar límites de tamaño  

![particionado](images/particionado.png)

## 4.2 Tipos
- **Horizontal:** filas/documentos distribuídos  
- **Vertical:** columnas distribuídas  

## 4.3 Estratexias
- Por rangos  
- Por listas  
- Por hash  

### Exemplos
- **Elasticsearch:** shards primarios e réplicas  
- **MongoDB:** particionado por clave shard key  
- **Cassandra:** hashing consistente  

---

# 5. Replicación

## 5.1 Tipos
### Maestro-esclavo / Primario-secundario
- Un nodo escribe  
- Secundarios replican  
![replicación mestre-esclavo](images/repicacion-mestre-esclavo.png)

### Peer-to-peer
- Todos os nodos escriben  
- Pode haber conflitos  
![replicación p2p](images/replicacion-p2p.png)
### Modelo Elasticsearch
- Cada shard primario ten réplicas  
- Lecturas moi rápidas e tolerancia a fallos  

---
En definitiva, un contorno seguro é aquel no que os datos están **particionados** e **replicados**.
![replicación e particionado](images/replicacion-particionado.png)
# 6. Implantación de NoSQL
Factores a ter en conta:
- Escalabilidade e rendemento
- Identificar alternativas viables respecto a software propietario
- Incrementar velocidade do proceso de desenvolvemento.

## 6.1 Dimensións clave
- Modelo de datos  
- Modelo de consultas  
- Modelo de consistencia  
- APIs e soporte  
- Comunidade  

## 6.2 Casos de uso xerais
- Datos personalizables → documental  
- Caché → clave-valor  
- Volumes masivos pouco consistentes → columnar  
- Relacións complexas → grafos  

---

# 7. Modelos NoSQL detallados

---------------------------------------------------------------------

# 7.1 Modelo Documental
Frente as BBDDR, que almacenan datos en filas e columnas, as BBDD Documentais emplean Documentos (estructura JSON), que permiten modelar datos de maneira similar á OO.
Os documentos agrúpanse en coleccións ou BBDD.
Os datos van xuntos e almacénanse xuntos.

![modelo documental](images/modelo-documental.png)

## Características
- Documentos JSON/BSON  
- Esquema flexible  
- Consultas complexas  
- Relacións embebidas ou referenciadas  
- Escalabilidade horizontal  

## Exemplos
- [MongoDB](https://www.mongodb.com)
- [CouchDB](https://couchdb.apache.org)
- [Elasticsearch](https://www.elastic.co/elasticsearch)


## Casos de uso
Recomendado:
- CMS  
- eCommerce  
- APIs  
- Logs indexados (Elasticsearch)  

Non recomendado:
- Transaccións complexas  
- Relacións moi profundas  

---

# 7.2 Modelo Clave-Valor
- Táboa hash onde todos los accesos se realizan a través da clave primaria.
- Son o modelo NoSQL más básico.
- O seu funcionamiento é similar a una táboa relacional con dúas columnas.
  - Id: Identificador.
  - Valor: pode ser un dato simple ou un objecto.

![modelo clave-valor](images/mocelo-clave-valor.png)
## Características
- Acceso por clave  
- Rendemento extremo  
- Valores opacos  

## Exemplos
- [Redis](https://redis.io)
- [Riak](https://riak.com)
- [Amazon DynamoDB](https://aws.amazon.com/dynamodb/)
- [Voldemort (implementación open-source de DynamoDB)](http://Project-Voldemort.com/voldemort)


## Casos de uso
Recomendado:
- Caché  
- Sesións  
- Contadores  
- Rate-limiting  

Non recomendado:
- Consultas complexas  
- Relacións  

---

# 7.3 Modelo Columnar
- Nas BBDDR por cada entrada créase unha fila.
- No modelo columnar, polo contrario, créase unha columna.
- En ambos casos, en disco, os datos escríbense de forma secuencial.
- Os SGBBDD que siguen este modelo están baseados na tecnoloxía BigTable de Google

![modelo columnar](images/modelo-columnas.png)
## Características
- Datos organizados en Column Families  
- Lecturas por columnas moi eficientes  
- Altísima escalabilidade  

## Exemplos
- [Cassandra](https://cassandra.apache.org)
- [HBase](https://hbase.apache.org)
- [Bigtable](https://cloud.google.com/bigtable)
- [Amazon Redshift](https://aws.amazon.com/redshift/)


## Casos de uso
Recomendado:
- Analítica  
- Data Lakehouse  
- Time-series  

Non recomendado:
- OLTP tradicional  

---

# 7.4 Modelo de Grafos
Almacenan entidades e as relacións entre estas:
- **Nodos** (entidades): Identificador e propiedades
- **Vértices** (relacións): Identificador, propiedades e dirección
Os datos almacénanse unha vez e interprétanse de diferentes maneiras dependendo das relacións.

![modelo grafos](images/modelo-grafos.png)
## Características
- Nodos + vértices  
- Traversals eficientes  

## Exemplos
- [Neo4j](https://neo4j.com/) — O grafo máis popular e maduro, ideal para recomendacións e RRSS.
- [ArangoDB](https://www.arangodb.com/) — Motor multimodelo (documental + grafo + clave-valor).
- [Amazon Neptune](https://aws.amazon.com/neptune/) — Grafo xestionado na nube, optimizado para RDF e Property Graph.
- [JanusGraph](https://janusgraph.org/) — Grafo distribuído open-source, compatible con Cassandra, HBase e Bigtable.
- [OrientDB](https://orientdb.org/) — Outro sistema multimodelo con capacidades de grafo e documental.


## Casos de uso
Recomendado:
- RRSS  
- Recomendacións  
- Mapas  

Non recomendado:
- Grandes cambios estruturais constantes  

---

# 8. Consistencia (CAP e BASE)

---------------------------------------------------------------------

# 8.1 Consistencia forte vs eventual
- **Forte:** todas as réplicas sincronizadas  
- **Eventual:** pode haber atraso  

---

# 8.2 Teorema CAP explicado

Nun sistema distribuído só podes ter 2 de:

- **C → Consistencia**: As escritursa son atómicas e todas as peticións posteriores obteñen el nuevo valor.  
- **A → Dispoñibilidade** :  BD devolve sempre un valor (non hai *downtime*).
- **P → Particións toleradas**: O sistema funcionará incluso se a conexión co servidor se interrompe.

![cap](images/cap.png)

Como P sempre debe existir en sistemas distribuídos reais, elixes entre **C ou A cando hai fallos**.

![cap 2](images/cap2.png)
---

## Exemplos reais

### **1. Banco / Caixeiro → CP**
- Prefírese non operar se hai dúbidas  
- Priorízase consistencia  

BD asociada: **HBase**

---

### **2. Twitter / Instagram → AP**
- Sempre responde  
- Podes non ver o último cambio inmediatamente  

BD asociada: **Cassandra**, **Elasticsearch**

---

### **3. Sistema local monolítico → CA (teórico)**

---

# 8.3 Modelo BASE explicado

- **Basically Available:** sempre responde  
- **Soft State:** pode haber estados intermedios  
- **Eventual Consistency:** sincronización final garantida  

---

# 8.4 Resumo práctico

| Sistema | Modelo CAP | Consistencia |
|---------|-------------|--------------|
| Cassandra | AP | eventual |
| Elasticsearch | AP | eventual |
| MongoDB | configurable | forte/eventual |
| HBase | CP | forte |

---

# 9. Comparativa xeral dos modelos NoSQL

| Modelo | Estrutura | Vantaxes | Limitacións | Exemplos |
|--------|-----------|----------|-------------|-----------|
| Documental | JSON | Flexibilidade, consultas, API-friendly | Transaccións limitadas | MongoDB, CouchDB, Elasticsearch |
| Clave-Valor | Key → Value | Máxima velocidade | Non consulta por valor | Redis, Riak, DynamoDB |
| Columnar | Column Families | Analítica, big data | Non apto para OLTP | Cassandra, HBase |
| Grafos | Nodos + relacións | Relacións complexas | Peor en datos masivos | Neo4j, ArangoDB |

---

# 10. Casos de uso modernos e realistas

## 10.1 Observabilidade e logs → Elasticsearch
- Logs  
- Monitorización  
- Dashboards (Kibana)  

## 10.2 Microservizos → MongoDB / DynamoDB  
- APIs  
- Perfiles  
- Inventario  

## 10.3 Analítica masiva → Cassandra  
- Time-series  
- Telemetría  
- Uso global  

## 10.4 Recomendacións → Grafos  
- RRSS  
- Produtos relacionados  

## 10.5 IoT e sensores → Cassandra / Elasticsearch  
- Envío masivo de datos  
- Consultas por tempo  

---

# 11. Referencias
- [Apuntamentos de Aitor Medrano](https://aitor-medrano.github.io/)
- [Next Generation Databases](https://link.springer.com/book/10.1007/978-1-4842-1329-2)
- [Understanding Database Sharding](https://www.digitalocean.com/community/tutorials/understanding-database-sharding)
- [The Design and Implementation of Modern Column-Oriented Database Systems (Foundations and Trends in Databases)](https://www.amazon.com/Implementation-Column-Oriented-Database-Foundations-Databases/dp/1601987544)
 ## Documentación oficial

- **MongoDB** → https://www.mongodb.com/docs/
- **Elasticsearch** → https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html
- **OpenSearch** → https://opensearch.org/docs/latest/
- **Apache Cassandra** → https://cassandra.apache.org/doc/latest/
- **Apache HBase** → https://hbase.apache.org/book.html
- **Neo4j** → https://neo4j.com/docs/
