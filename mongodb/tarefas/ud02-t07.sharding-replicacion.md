# Replicación e particionado en MongoDB

Empregando os **clústers dispoñibles na sección de recursos complementarios**, realiza os seguintes exercicios.

---

## 1. Replica set

### a. Engadir un novo nodo (1)
Engade un contedor adicional chamado **`mongo4`**.  
Debes modificar:
- o ficheiro `docker-compose.yml`
- o script `rs-init.sh`

### b. Lanzamento do replica set (1)
Lanza os servizos e executa os scripts necesarios.

### c. Nodo primario (0,5)
Conéctate a **`mongo1`** e demostra que é o nodo **primario**.

### d. Preferencias de lectura (0,5)
Amosa as **preferencias de lectura** do replica set.

### e. Degradación do primario (0,5)
Degrada o nodo primario empregando o comando `stepDown`.

### f. Novo nodo primario (0,5)
Conéctate aos demais nodos ata atopar o **novo nodo primario**.

---

### Entregar (Replica set)

| Apartado | Evidencia a entregar |
|---------|----------------------|
| a | Capturas dos dous ficheiros modificados |
| b | Captura do comando `docker compose` e do seu resultado<br>Captura da execución do script |
| c | Captura de `mongosh` executándose no nodo `mongo1` |
| d | Captura amosando as preferencias de lectura |
| e | Captura degradando o nodo primario (`stepDown`) |
| f | Captura conectado ao novo nodo primario |

---

## 2. Replica set con particionado (sharded)

### a. Cambio de nome do clúster (0,5)
Cambia o nome do clúster a **`xyzshard`**  
*(onde `xyz` son as túas iniciais)*.

Os shards deberán chamarse:
- `xyzshard1`
- `xyzshard2`

### b. Lanzamento dos servizos (0,5)
Lanza os servizos e executa **todos os scripts** necesarios.

### c. Estado do particionado (0,5)
Conéctate ao **router** e amosa o estado do particionado.

### d. Creación e particionado da BD (0,5)
Crea unha base de datos coas túas iniciais e **habilita o particionado** nela.

### e. Inserción masiva de datos (0,5)
Engade **100.000 usuarios** nunha colección chamada **`usuarios`**  
na mesma base de datos, replicando o bucle `for` dos apuntamentos.

### f. Índice e particionado da colección (1)
Crea un **índice simple** e habilita o **particionado na colección**.

### g. Estado da distribución (0,5)
Amosa os resultados dos seguintes comandos:
- `sh.status()`
- `db.usuarios.getShardDistribution()`

### h. Configuración de chunks e balanceador (0,5)
Modifica a configuración para:
- cambiar o tamaño dos **chunks**
- configurar o **balanceador** na colección  

Todo isto debe facerse tal e como se indica nos apuntamentos.

### i. Redistribución dos chunks (1)
Repite o apartado **g**.  
Agora os **chunks deben estar correctamente distribuídos**.

---

### Entregar (Sharded)

| Apartado | Evidencia a entregar |
|---------|----------------------|
| a | Capturas dos dous ficheiros modificados |
| b | Captura do comando `docker compose` e do seu resultado<br>Captura da execución dos scripts |
| c | Captura de `sh.status()` no router |
| d | Captura da creación da BD e da habilitación do particionado |
| e | Captura da inserción dos documentos |
| f | Captura da creación do índice e da habilitación do particionado |
| g | Captura dos resultados dos comandos |
| h | Captura da execución dos comandos |
| i | Captura dos resultados finais dos comandos |

