# Primeiros pasos con OpenSearch

Unha vez instalado e en execuci√≥n o contorno de OpenSearch, nesta secci√≥n real√≠zase unha primeira toma de contacto co sistema, centrada na creaci√≥n de √≠ndices, inserci√≥n de documentos e realizaci√≥n de consultas b√°sicas.

O obxectivo √© comprender o modelo de datos e o funcionamento das buscas antes de integrar OpenSearch en arquitecturas m√°is complexas.

---

## Acceso ao servizo

Para traballar coa API REST de OpenSearch de forma c√≥moda e sen problemas de configuraci√≥n, empregarase **Dev Tools (Console)**, inclu√≠do en OpenSearch Dashboards.

1. Acceder a OpenSearch Dashboards en:  
   `http://localhost:5601`
2. Ir ao men√∫ **Dev Tools ‚Üí Console**

Desde esta consola p√≥dense executar directamente petici√≥ns REST contra OpenSearch.

---

## Creaci√≥n dun √≠ndice

Un √≠ndice √© a unidade l√≥xica principal onde se almacenan os documentos. No seguinte exemplo cr√©ase un √≠ndice sinxelo chamado `eventos`.

```http
PUT eventos
```
Se a operaci√≥n √© correcta, OpenSearch devolver√° unha resposta de confirmaci√≥n.
```json
{"acknowledged":true,"shards_acknowledged":true,"index":"eventos"}
```

## Inserci√≥n de documentos
Os datos en OpenSearch almac√©nanse en forma de **documentos JSON**. A continuaci√≥n ins√≠rense dous documentos de exemplo no √≠ndice `eventos`.
```http
POST eventos/_doc
{
  "mensaxe": "login correcto",
  "usuario": "ana",
  "nivel": "info",
  "servizo": "auth",
  "timestamp": "2026-02-10T08:15:00"
}

```

## Consulta b√°sica de documentos
1. Recuperar todos os documentos:
```http
GET eventos/_search
```

2. Busca full-text:
```http
GET eventos/_search
{
  "query": {
    "match": {
      "mensaxe": "login"
    }
  }
}

```

3. **Filtros por campo**
Para realizar filtros exactos sobre campos non analizados, empr√©gase `term`.

```http
GET eventos/_search
{
  "query": {
    "term": {
      "nivel": "warn"
    }
  }
}

```

4. **Consultas booleanas**
√â posible combinar varias condici√≥ns mediante consultas booleanas:
```http
GET eventos/_search
{
  "query": {
    "bool": {
      "must": [
        { "match": { "mensaxe": "login" } }
      ],
      "filter": [
        { "term": { "servizo": "auth" } }
      ]
    }
  }
}
```

## Visualizaci√≥n en Opensearch Dashboards
Ademais da consola, OpenSearch Dashboards permite explorar os datos de forma visual.
1. Ir a **Discover**.
2. Crear un *Index Pattern* para o √≠ndice `eventos`.
![index pattern create](images/opensearch_index_pattern-1.png)
![Define index pattern](images/opensearch-index-patterns-2.png)
3. Seleccionar o campo `timestamp` como campo temporal.
![timestamp](images/opensearc_index_pattern_timestamp.png)
4. Agora podemos explorar os documentos, aplicar filtros e intervalos de tempo, etc.

## Exploraci√≥n de documentos en Discover

Unha vez creado o *Data View* para o √≠ndice `eventos`, p√≥dense explorar os documentos de forma interactiva mediante a vista **Discover** en OpenSearch Dashboards.

---

### Acceso a Discover

1. Acceder a **OpenSearch Dashboards**
2. Ir ao men√∫ **Discover**
3. Seleccionar o *Data View* asociado ao √≠ndice `eventos`

Nesta vista m√≥strase a lista de documentos indexados e os seus campos.

---

### Exploraci√≥n dos documentos

Na vista **Discover**, cando o *Data View* ten configurado un campo temporal, a interface m√≥strase dividida en d√∫as partes:

1. Na parte superior aparece un **histograma temporal**, que representa a distribuci√≥n dos documentos ao longo do tempo segundo o filtro seleccionado.
2. Debaixo do gr√°fico m√≥strase a **lista de documentos en formato t√°boa**.

Se non se visualizan os documentos, d√©bese comprobar:
- O **rango temporal** (parte superior dereita).
- Que non existan **filtros activos**.
- Que o histograma non estea ocupando toda a pantalla (p√≥dese desprazar cara abaixo).

![Data view](images/opensearch_dataview.png)
---

Na t√°boa de resultados:

- Cada fila corresponde a un **documento**
- P√≥dese premer sobre un documento para ver o seu contido completo
- Os campos aparecen estruturados en formato JSON
- O n√∫mero total de resultados (*hits*) aparece indicado na parte superior

√â posible:

- Ordenar documentos por calquera campo
- Seleccionar que campos se mostran na t√°boa
- Engadir ou eliminar columnas
- Ver o valor exacto de cada campo
- Filtrar directamente facendo clic sobre un valor concreto


---

### Aplicaci√≥n de filtros por campo

Os filtros permiten restrinxir os documentos visibles segundo condici√≥ns concretas.

‚ö†Ô∏è Importante:  
Se na t√°boa s√≥ aparece a columna `_source`, non ser√° posible aplicar filtros directamente sobre os valores. Primeiro hai que engadir os campos como columnas individuais.

---

### Engadir campos √° t√°boa

1. No panel lateral esquerdo, localizar o campo (por exemplo `nivel`)
2. Premer no bot√≥n **+** situado ao lado do nome do campo
3. O campo engadirase como nova columna na t√°boa de resultados

Recom√©ndase engadir como columnas os campos m√°is relevantes (`nivel`, `usuario`, `servizo`, `mensaxe`, etc.) para facilitar a an√°lise.

---

### Aplicar filtro desde a t√°boa

Unha vez que o campo est√° visible como columna:

1. Localizar na t√°boa un valor concreto (por exemplo `warn`)
2. Pasar o rato sobre ese valor
3. Seleccionar:
   - ‚ûï **Filter for value** (inclu√≠r)
   - ‚ûñ **Filter out value** (exclu√≠r)

O filtro aplicarase automaticamente e s√≥ se mostrar√°n os documentos que cumpran a condici√≥n.

---

### Crear filtros manualmente

Tam√©n √© posible crear filtros desde a barra superior:

1. Premer en **Add filter**
2. Seleccionar o campo
3. Escoller o operador (`is`, `is not`, `exists`, etc.)
4. Indicar o valor correspondente
5. Aplicar o filtro

Este m√©todo permite combinar varias condici√≥ns e realizar consultas m√°is complexas.


### Uso do buscador (KQL / Lucene)

Na barra de busca p√≥dense escribir consultas sinxelas, por exemplo:

```kql
nivel: warn
```

Ou combinar condici√≥ns:
```kql
servizo: auth AND nivel: warn
```

Este m√©todo permite explorar rapidamente os datos sen escribir consultas JSON.

---

### Selecci√≥n de intervalos de tempo

Se o *Data View* ten definido un campo temporal (por exemplo `timestamp`), Discover permite filtrar os datos por tempo.

1. Na esquina superior dereita, localizar o selector de tempo
2. Escoller un intervalo predefinido:
   - Last 15 minutes
   - Last 1 hour
   - Last 24 hours
3. Ou definir un intervalo personalizado

S√≥ se mostrar√°n os documentos cuxo campo temporal estea dentro do intervalo seleccionado.
> No noso caso temos que cabmiar o intervalo aos √∫ltimos dous anos (por exemplo) para que aparezan os eventos.
---

### Actualizaci√≥n en tempo real

√â posible activar a **actualizaci√≥n autom√°tica** para ver como aparecen novos documentos a medida que se indexan.

- Activar *Auto refresh*
- Escoller a frecuencia (por exemplo, cada 5 segundos)

Isto √© especialmente √∫til cando se traballa con logs ou datos en tempo real.

---

### Resumo

A vista **Discover** permite:

- Explorar documentos individualmente
- Aplicar filtros por campos
- Realizar buscas sinxelas sen JSON
- Filtrar datos por intervalos de tempo
- Analizar informaci√≥n de forma visual e interactiva

Discover √© a ferramenta principal para a an√°lise exploratoria de datos en OpenSearch Dashboards.

## Conclusi√≥n e seguintes pasos

Neste documento realizouse unha primeira aproximaci√≥n pr√°ctica a OpenSearch, cubrindo os conceptos e operaci√≥ns fundamentais necesarios para comezar a traballar coa ferramenta.

Ao rematar esta secci√≥n, deber√≠ase ser capaz de:

- Comprender o **modelo de datos** de OpenSearch (√≠ndices e documentos)
- Crear √≠ndices e inserir documentos en formato JSON
- Realizar **consultas b√°sicas** empregando Query DSL
- Explorar os datos de forma interactiva mediante **Discover**
- Aplicar filtros, buscas e **intervalos temporais**
- Entender a importancia do tempo na an√°lise de eventos e logs

Este primeiro contacto c√©ntrase nun uso manual e controlado de OpenSearch, pensado para comprender os conceptos clave antes de avanzar cara a escenarios m√°is realistas.

---

### Cara a onde imos a continuaci√≥n

A partir desta base, OpenSearch pode empregarse en contextos m√°is avanzados, como:

- **An√°lise de logs e eventos reais**
- Uso de **agregaci√≥ns** para obter m√©tricas e estat√≠sticas
- Creaci√≥n de **visualizaci√≥ns e dashboards**
- Integraci√≥n con ferramentas de inxesti√≥n e procesamento como:
  - Kafka
  - Apache Spark
  - Logstash ou NiFi

Nos seguintes apartados profundarase nestes aspectos, empregando OpenSearch como **capa de consulta, an√°lise e visualizaci√≥n** dentro dunha arquitectura Big Data m√°is ampla.

## Referencias e linguaxes de consulta en OpenSearch

OpenSearch permite consultar e analizar os datos empregando diferentes linguaxes, orientadas a distintos perf√≠s de usuario. Todas elas se basean internamente na **API REST e na Query DSL**, pero ofrecen niveis de abstracci√≥n distintos.

A continuaci√≥n incl√∫ense as referencias oficiais m√°is relevantes para cada unha delas.

---

### Query DSL (JSON)

√â a linguaxe **nativa** de OpenSearch e a base de todas as demais. Permite definir consultas complexas, filtros e agregaci√≥ns mediante documentos JSON.

- Uso principal: Dev Tools, integraci√≥ns, automatizaci√≥n
- Perfil: t√©cnico / enxe√±ar√≠a de datos

üìò Documentaci√≥n oficial:  
https://opensearch.org/docs/latest/query-dsl/

---

### Lucene Query Syntax (Discover)

√â a linguaxe empregada na barra de busca de **Discover** para realizar consultas sinxelas de forma r√°pida, sen escribir JSON.

- Uso principal: exploraci√≥n interactiva de datos
- Perfil: analista / operador

üìò Documentaci√≥n oficial:  
https://opensearch.org/docs/latest/query-dsl/full-text/lucene-query-syntax/

---

### SQL (plugin de OpenSearch)

OpenSearch incl√∫e un plugin que permite realizar consultas empregando unha sintaxe similar a SQL, especialmente √∫til para usuarios con experiencia en bases de datos relacionais.

- Uso principal: an√°lise exploratoria, agregaci√≥ns
- Perfil: usuarios con co√±ecementos de SQL

üìò Documentaci√≥n oficial:  
https://opensearch.org/docs/latest/search-plugins/sql/

---

### PPL (Piped Processing Language)

PPL √© unha linguaxe de tipo *pipeline*, orientada √° an√°lise de logs e eventos, cun estilo similar a outras linguaxes usadas en observabilidade.

- Uso principal: an√°lise de logs e m√©tricas
- Perfil: observabilidade / an√°lise de eventos

üìò Documentaci√≥n oficial:  
https://opensearch.org/docs/latest/search-plugins/sql/ppl/

---

### API REST de OpenSearch

Todas as linguaxes anteriores trad√∫cense internamente a chamadas √° **API REST**, que √© a interface fundamental de OpenSearch.

- Uso principal: integraci√≥ns, clientes, ferramentas de inxesti√≥n

üìò Documentaci√≥n oficial:  
https://opensearch.org/docs/latest/api-reference/
